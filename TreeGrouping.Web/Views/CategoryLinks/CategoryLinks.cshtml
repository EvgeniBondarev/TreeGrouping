@model List<TreeGrouping.Application.DbService.Models.CategoryLinkModel>

@{
    ViewData["Title"] = "Связки категорий";
}

@foreach (var category in Model)
{
    <div class="category-link-block" id="category-link-@category.Id">
        <h3>Связка @category.Id</h3>

        <div class="category-container">
            <div class="category-column">
                <h4>Volna</h4>
                <div id="volna-category-container-@category.Id"></div>
            </div>

            <div class="category-column">
                <h4>Ozon</h4>
                <div id="ozon-category-container-@category.Id"></div>
            </div>

            <div class="category-column">
                <h4>CT</h4>
                <div id="ct-category-container-@category.Id"></div>
            </div>
        </div>

        <!-- Кнопка удаления -->
        <a href="#" onclick="deleteCategoryLink(@category.Id)">Удалить</a>
    </div>
}

<style>
    .category-container {
        display: flex;
        justify-content: space-between; /* Равномерное распределение колонок */
        gap: 20px; /* Отступы между колонками */
    }

    .category-column {
        flex: 1; /* Колонки равной ширины */
        border: 1px solid #ccc;
        padding: 10px;
        min-width: 200px; /* Минимальная ширина колонки */
    }

    .category-link-block {
        margin-bottom: 30px; /* Отступ между разными связками */
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let categories = @Html.Raw(Json.Serialize(Model));

        categories.forEach(category => {
            loadCategories("volna-category-container-" + category.id, '@Url.Action("GetVolnaCategoriesById", "Category")', category.volnaCategoryId);
            loadCategories("ozon-category-container-" + category.id, '@Url.Action("GetOzonCategoriesById", "Category")', category.ozonCategoryId);
            loadCategories("ct-category-container-" + category.id, '@Url.Action("GetCtCategoriesById", "Category")', category.ctCategoryId);
        });
    });

    function loadCategories(containerId, action, categoryId) {
        if (!categoryId) return;
        $.get(action, { id: categoryId }, function (data) {
            $("#" + containerId).html(data);
        });
    }

    function deleteCategoryLink(id) {
        if (!confirm("Вы уверены, что хотите удалить эту связку?")) return;

        $.ajax({
            url: '@Url.Action("DeleteCategoryLink", "CategoryLinks")',
            type: 'POST',
            data: { id: id },
            success: function (response) {
                alert("Связка удалена успешно!");
                $("#category-link-" + id).remove();
            },
            error: function () {
                alert("Ошибка при удалении связки.");
            }
        });
    }
</script>
